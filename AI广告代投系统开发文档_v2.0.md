# AI广告代投系统开发文档 v2.0

> **项目名称**: AI广告代投与财务管理系统
> **文档版本**: v2.0 模块化版
> **创建日期**: 2025-11-10
> **文档类型**: 企业级开发标准
> **维护团队**: 系统架构团队

---

## 📋 文档架构概览

本系统采用模块化文档架构，便于团队协作和维护：

### 核心文档清单
| 文档名称 | 用途 | 优先级 | 状态 |
|----------|------|--------|------|
| [SYSTEM_OVERVIEW.md](./SYSTEM_OVERVIEW.md) | 系统概述、业务主链、技术架构 | P0 | ✅ 完成 |
| [BACKEND_API_GUIDE.md](./BACKEND_API_GUIDE.md) | 后端接口、统一返回结构、错误码 | P0 | ✅ 完成 |
| [DATA_SCHEMA.md](./DATA_SCHEMA.md) | 数据库设计、RLS策略、外键约束 | P0 | ✅ 完成 |
| [STATE_MACHINE.md](./STATE_MACHINE.md) | 状态机定义、转换规则、权限控制 | P0 | ✅ 完成 |
| [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) | 部署配置、环境变量、监控设置 | P0 | ✅ 完成 |
| [FRONTEND_GUIDE.md](./FRONTEND_GUIDE.md) | 前端路由、角色菜单、API调用 | P0 | ✅ 完成 |

### 文档使用指南

#### 🎯 开发团队
1. **首次阅读**: 从 SYSTEM_OVERVIEW.md 开始了解整体架构
2. **后端开发**: 参考 BACKEND_API_GUIDE.md 和 DATA_SCHEMA.md
3. **前端开发**: 参考 FRONTEND_GUIDE.md 和 BACKEND_API_GUIDE.md
4. **部署运维**: 参考 DEPLOYMENT_GUIDE.md

#### 🔄 开发流程
1. **需求分析** → SYSTEM_OVERVIEW.md (业务主链)
2. **接口设计** → BACKEND_API_GUIDE.md (统一规范)
3. **数据库设计** → DATA_SCHEMA.md (表结构+RLS)
4. **状态管理** → STATE_MACHINE.md (业务流程)
5. **前后端开发** → FRONTEND_GUIDE.md + BACKEND_API_GUIDE.md
6. **部署上线** → DEPLOYMENT_GUIDE.md

#### ⚠️ 重要说明
- **统一返回结构**: 参见 BACKEND_API_GUIDE.md 第1章
- **权限矩阵**: 参见 SYSTEM_OVERVIEW.md 第3章
- **状态机规则**: 参见 STATE_MACHINE.md，不允许跳级
- **RLS策略**: 参见 DATA_SCHEMA.md，中间件自动注入
- **外键约束**: 所有资金表必须包含 project_id, ad_account_id, user_id

---

## 🚀 技术栈标准

### 前端技术栈
- **框架**: Next.js 14 + TypeScript + App Router
- **UI组件**: shadcn/ui (推荐) 或 Ant Design (二选一)
- **图表**: Recharts
- **状态管理**: SWR / React Query
- **样式**: Tailwind CSS

### 后端技术栈
- **框架**: FastAPI (Python 3.11)
- **数据验证**: Pydantic v2
- **ORM**: SQLAlchemy (同步版)
- **部署**: Uvicorn/Gunicorn
- **事务**: 装饰器模式统一管理

### 数据库与认证
- **数据库**: PostgreSQL (Supabase托管)
- **认证**: Supabase Auth + JWT
- **安全**: RLS行级安全策略
- **缓存**: Redis (导入任务、审批通知)

### 开发工具
- **容器**: Docker + Docker Compose
- **代理**: Nginx
- **CI/CD**: GitHub Actions
- **监控**: 健康检查 + metrics

---

## 📊 优先级矩阵

### P0 (必须优先完成)
- [x] 项目/渠道/账户 CRUD
- [x] 日报提交流程
- [x] 充值审批流程（含状态机）
- [x] 对账基础统计
- [x] 权限矩阵 + RLS注入
- [x] 操作日志表

### P1 (提高效率)
- [x] 报表与看板
- [x] 导入任务管理
- [x] 渠道质量评分
- [x] 通知/预警系统
- [x] 健康检查监控

### P2 (AI与分析)
- [x] AI异常检测（规则版）
- [x] 账户寿命预测
- [x] 多币种试算
- [x] 智能推荐系统

---

## 🔧 核心设计原则

### 1. 数据安全优先
- 所有API请求必须通过用户认证
- RLS策略确保数据访问安全
- 操作日志记录所有关键操作

### 2. 业务流程严谨
- 状态机控制业务流转，不允许跳级
- 所有资金表必须包含完整外键追溯
- 异常情况必须可追踪和处理

### 3. 技术栈统一
- 前后端技术栈保持一致性
- 统一的错误处理和响应格式
- 标准化的开发和部署流程

### 4. 可扩展性设计
- 模块化架构便于功能扩展
- AI功能预留接口和配置
- 监控和日志支持运维扩展

---

## 🎯 业务主链

```
甲方签约付款 → 创建项目 → 申请渠道账户 → 分配账户给投手
      ↓
投手投放广告 → 每日提交日报 → 数据员审核甲方粉数
      ↓
提交充值申请 → 数据员审核需求 → 财务审批 → 财务打款给代理商
      ↓
代理商充值 → 月底财务对账 → 项目盈利分析
```

### 关键业务规则
1. **四层数据关系**: 项目 → 渠道 → 账户 → 投手
2. **粉数确认**: 最终由甲方反馈决定，不是系统自动统计
3. **充值流程**: 投手→数据员→财务→代理商
4. **数据追溯**: 所有数据必须能追溯到"项目+渠道+账户+投手"

---

## 📞 技术支持

### 开发团队
- **技术架构师**: 负责整体技术架构和关键决策
- **后端负责人**: API设计和数据库优化
- **前端负责人**: 用户界面和交互体验
- **运维负责人**: 部署配置和系统监控
- **AI算法负责人**: 智能预测和异常检测

### 联系方式
- **技术问题**: 提交GitHub Issue或联系架构师
- **紧急故障**: 立即联系运维负责人
- **业务咨询**: 联系产品经理

---

## 📋 文档维护

### 版本控制
- **主版本**: 重大架构变更 (v1.0 → v2.0)
- **次版本**: 功能模块新增 (v2.0 → v2.1)
- **修订版本**: Bug修复和小优化 (v2.0.1)

### 更新流程
1. **变更提出**: 开发团队提交变更申请
2. **影响评估**: 架构师评估技术影响
3. **文档更新**: 相关模块负责人更新文档
4. **版本发布**: 统一发布并通知团队

### 质量保证
- 所有代码示例必须经过验证
- 配置文件需要实际测试
- 业务规则要与实际系统一致

---

**文档版本**: v2.0
**最后更新**: 2025-11-10
**下次审查**: 功能重大变更时
**维护责任人**: 系统架构团队